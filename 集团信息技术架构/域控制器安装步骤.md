# 域控制器安装步骤指南

## 1. Windows Server安装

### 1.1 基础系统安装
1. 使用Windows Server 2019安装介质启动服务器
2. 在启动界面出现"Press any key to boot from CD or DVD"时按任意键
3. 等待Windows安装程序加载
4. 在语言选择界面：
   - "Language to install": 选择 "English (United States)"
   - "Time and currency format": 选择 "Chinese (Simplified, China)"
   - "Keyboard or input method": 选择 "Chinese (Simplified, China)"
   - 点击 "Next"

5. 点击 "Install now"

6. 在产品密钥界面：
   - 输入产品密钥
   - 点击 "Next"
   - 如果是评估版，选择 "I don't have a product key"

7. 选择要安装的操作系统版本：
   - 选择 "Windows Server 2019 Datacenter (Desktop Experience)"
   - 点击 "Next"

8. 接受许可条款：
   - 勾选 "I accept the license terms"
   - 点击 "Next"

9. 选择安装类型：
   - 选择 "Custom: Install Windows only (advanced)"

10. 选择安装位置：
    - 选择目标磁盘（建议至少100GB空间）
    - 如需分区，点击 "New" 并设置分区大小
    - 点击 "Next"

11. 等待系统文件复制和安装完成（约20-30分钟）

12. 系统将自动重启

### 1.2 初始配置
1. 在首次启动界面设置管理员密码：
   - 密码必须包含大小写字母、数字和特殊字符
   - 长度至少12位
   - 点击 "Finish"

2. 按Ctrl+Alt+Delete登录系统

3. 配置网络设置：
   - 右键点击任务栏网络图标
   - 选择 "Open Network & Internet settings"
   - 点击 "Change adapter options"
   - 右键点击网络适配器，选择 "Properties"
   - 选择 "Internet Protocol Version 4 (TCP/IPv4)"
   - 点击 "Properties"
   - 配置固定IP地址：
     * IP地址：根据网络规划设置
     * 子网掩码：255.255.255.0
     * 默认网关：根据网络规划设置
     * DNS服务器：127.0.0.1（本地回环地址）

4. 修改计算机名：
   - 打开 "System" 设置
   - 点击 "Rename this PC"
   - 输入服务器名称（如：DC01-HQ）
   - 点击 "Next"
   - 选择 "Restart now"

## 2. 安装域控制器角色

### 2.1 安装所需角色
1. 打开服务器管理器（Server Manager）：
   - 如果没有自动打开，点击开始菜单找到 "Server Manager"

2. 点击 "Manage" → "Add Roles and Features"

3. 在安装向导中：
   - 点击 "Next" 直到 "Server Roles" 页面
   - 勾选 "Active Directory Domain Services"
   - 在弹出的对话框中点击 "Add Features"
   - 点击 "Next"
   - 在 "Features" 页面点击 "Next"
   - 在确认页面点击 "Install"
   - 等待安装完成
   - 点击 "Close"

### 2.2 配置域控制器
1. 在服务器管理器中点击黄色警告图标
2. 点击 "Promote this server to a domain controller"

3. 在Active Directory域服务配置向导中：
   - 选择 "Add a new forest"
   - 在 "Root domain name" 输入：mslinfo.com
   - 点击 "Next"

4. 在域控制器选项页面：
   - 选择林功能级别：Windows Server 2016
   - 选择域功能级别：Windows Server 2016
   - 确保已勾选 "Domain Name System (DNS) server"
   - 确保已勾选 "Global Catalog (GC)"
   - 输入目录服务还原模式(DSRM)密码
   - 点击 "Next"

5. 在DNS选项页面：
   - 忽略DNS委派警告
   - 点击 "Next"

6. 在其他选项页面：
   - NetBIOS域名将自动填写
   - 点击 "Next"

7. 在路径页面：
   - 保持默认路径或根据需要修改
   - 数据库文件夹：%SystemRoot%\NTDS
   - 日志文件文件夹：%SystemRoot%\NTDS
   - SYSVOL文件夹：%SystemRoot%\SYSVOL
   - 点击 "Next"

8. 在审查选项页面：
   - 检查所有配置是否正确
   - 点击 "Next"

9. 在先决条件检查页面：
   - 等待检查完成
   - 确保没有严重警告
   - 点击 "Install"

10. 等待安装完成，服务器将自动重启

## 3. 域控制器初始配置

### 3.1 验证安装
1. 登录到域控制器：
   - 用户名：MSLINFO\Administrator
   - 密码：之前设置的密码

2. 验证DNS服务：
   - 打开命令提示符
   - 运行 `nslookup mslinfo.com`
   - 确认能够解析域名

3. 验证Active Directory：
   - 打开 "Active Directory Users and Computers"
   - 确认可以看到域结构

### 3.2 配置基础服务
1. 配置时间同步：
   ```powershell
   w32tm /config /manualpeerlist:"time.windows.com" /syncfromflags:manual /reliable:yes /update
   net stop w32time
   net start w32time
   w32tm /resync /force
   ```

2. 配置Windows防火墙规则：
   ```powershell
   # 允许域相关服务
   netsh advfirewall firewall set rule group="Windows Management Instrumentation (WMI)" new enable=yes
   netsh advfirewall firewall set rule group="Remote Event Log Management" new enable=yes
   netsh advfirewall firewall set rule group="Remote Service Management" new enable=yes
   netsh advfirewall firewall set rule group="Remote Volume Management" new enable=yes
   ```

### 3.3 创建基础OU结构
1. 打开 "Active Directory Users and Computers"
2. 右键点击域名，选择 "New" → "Organizational Unit"
3. 创建以下OU结构：
   ```
   mslinfo.com
   ├── 总部
   │   ├── 用户
   │   ├── 计算机
   │   └── 服务器
   ├── 区域中心
   │   ├── APAC
   │   ├── EMEA
   │   └── AMER
   └── 本地站点
       ├── 用户
       └── 计算机
   ```

### 3.4 配置基础组策略
1. 打开 "Group Policy Management"
2. 创建密码策略：
   - 右键点击 "Group Policy Objects"
   - 选择 "New"
   - 名称：Default Password Policy
   - 编辑策略：
     * 最小密码长度：12个字符
     * 密码复杂度：启用
     * 密码历史：记住24个密码
     * 最长密码期限：90天
     * 最短密码期限：1天
     * 账户锁定阈值：5次
     * 账户锁定时间：30分钟

3. 创建安全策略：
   - 新建策略：Security Baseline
   - 配置以下设置：
     * 启用BitLocker
     * 配置USB设备限制
     * 配置审核策略
     * 配置远程访问限制

## 4. 安全加固

### 4.1 系统加固
1. 运行Windows Update安装最新补丁
2. 禁用不必要的服务
3. 配置事件日志大小和保留策略
4. 配置远程桌面设置：
   - 仅允许Network Level Authentication
   - 限制允许的IP地址范围

### 4.2 安全审核配置
1. 配置高级审核策略：
   - 账户登录事件
   - 账户管理
   - 目录服务访问
   - 特权使用
   - 系统事件

2. 配置日志转发：
   - 设置日志收集服务器
   - 配置订阅规则

## 5. 备份配置

### 5.1 系统状态备份
1. 打开Windows Server Backup
2. 配置计划备份：
   - 选择备份系统状态
   - 设置备份频率为每日
   - 配置备份存储位置
   - 设置保留策略

### 5.2 AD数据库备份
1. 配置自动备份脚本：
   ```powershell
   # 创建备份脚本
   $backupPath = "D:\Backup\AD"
   $date = Get-Date -Format "yyyyMMdd"
   New-Item -ItemType Directory -Force -Path "$backupPath\$date"
   ntdsutil "activate instance ntds" "ifm" "create full $backupPath\$date" q q
   ```

2. 创建计划任务每4小时运行一次

## 6. 监控配置

### 6.1 性能监控
1. 配置Performance Monitor
2. 添加关键计数器：
   - 处理器时间
   - 内存使用
   - 磁盘队列
   - 网络流量
   - LDAP查询性能

### 6.2 告警设置
1. 配置事件触发的邮件通知
2. 设置性能计数器阈值告警
3. 配置复制状态监控

## 7. 文档记录

### 7.1 配置文档
记录以下信息：
- 服务器硬件配置
- 网络配置
- 安装的角色和功能
- 组策略设置
- 备份配置
- 监控设置

### 7.2 运维文档
创建以下操作手册：
- 日常检查清单
- 故障处理流程
- 备份恢复程序
- 安全事件响应
- 变更管理流程

## 8. 验证清单

### 8.1 功能验证
- [ ] DNS解析正常
- [ ] 活动目录复制正常
- [ ] SYSVOL复制正常
- [ ] 组策略应用正常
- [ ] 时间同步正常
- [ ] 备份任务正常
- [ ] 监控告警正常

### 8.2 安全验证
- [ ] 防火墙规则正确
- [ ] 审核策略生效
- [ ] 密码策略生效
- [ ] 远程访问限制生效
- [ ] 系统补丁已安装
- [ ] 日志记录正常